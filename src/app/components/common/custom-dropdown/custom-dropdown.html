<div class="relative w-full">
  @if (label) {
    <label class="mb-1.5 block text-sm font-medium text-slate-700">
      {{ label }}
      @if (required) {
        <span class="text-red-500">*</span>
      }
    </label>
  }

  <button
    type="button"
    #trigger
    (click)="toggle()"
    [disabled]="disabled"
    class="flex h-10 w-full cursor-pointer items-center justify-between rounded-lg border border-slate-300 bg-white px-3 text-left text-slate-900 shadow-sm transition-colors hover:border-slate-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:bg-slate-50 disabled:opacity-70"
  >
    <span class="truncate">{{ selectedOption?.name ?? placeholder }}</span>
    <span class="flex shrink-0 items-center gap-1">
      @if (value && showClear && !disabled) {
        <span
          class="rounded p-0.5 text-slate-400 hover:bg-slate-100 hover:text-slate-600"
          (click)="clear($event); $event.stopPropagation()"
          role="button"
          aria-label="Clear selection"
        >
          ✕
        </span>
      }
      <span class="text-slate-500" aria-hidden="true">▾</span>
    </span>
  </button>

  @if (errorMessage) {
    <p class="mt-1.5 text-xs text-red-600">{{ errorMessage }}</p>
  }

  @if (isOpen) {
    <div
      class="fixed inset-0 z-40"
      (click)="isOpen = false"
      aria-hidden="true"
    ></div>
    <div
      class="absolute left-0 right-0 top-full z-50 mt-1 max-h-56 overflow-auto rounded-lg border border-slate-200 bg-white py-1 shadow-lg"
      role="listbox"
    >
      @if (enableFilter) {
        <div class="border-b border-slate-200 p-2">
          <input
            type="text"
            [(ngModel)]="filterText"
            (input)="filter()"
            placeholder="Filter options..."
            class="w-full rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-900 placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500/20"
          />
        </div>
      }

      <div class="py-1" role="group">
        @for (option of filteredOptions; track option.id) {
          <button
            type="button"
            (click)="select(option)"
            role="option"
            [attr.aria-selected]="option.id === value"
            class="w-full cursor-pointer px-3 py-2 text-left text-sm text-slate-700 transition-colors hover:bg-slate-100 focus:bg-slate-100 focus:outline-none"
            [class.bg-blue-500/10]="option.id === value"
            [class.text-blue-700]="option.id === value"
          >
            {{ option.name }}
          </button>
        }
        @if (filteredOptions.length === 0) {
          <p class="px-3 py-4 text-center text-sm text-slate-500">No options found</p>
        }
      </div>
    </div>
  }
</div>
